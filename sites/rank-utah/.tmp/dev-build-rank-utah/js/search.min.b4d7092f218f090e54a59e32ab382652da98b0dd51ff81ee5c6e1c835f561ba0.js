(function(){let r=typeof window!="undefined"&&window.SEARCH_INDEX_URL||"/index.json";typeof r=="string"&&(r=r.replace(/^['"]|['"]$/g,""));const i=new URLSearchParams(location.search).get("q")||"",e={lastTerm:"",lastResultsCount:0,committed:!1,lastNonEmptyTerm:""},v="✅",g="❌";let a=!1;try{a=window.localStorage&&localStorage.getItem("cp-debug-search")==="1"}catch{}function p(){return typeof window!="undefined"&&typeof window.gtag=="function"}function n(e){return String(e||"").replace(/\s+/g," ").trim()}function l(t){if(e.committed)return;const s=n(e.lastTerm);if(!s)return;const i=t==="success"?v:g,o=s+" "+i;if(p())try{const e={search_term:o,transport_type:"beacon"};a&&window.console&&console.debug&&console.debug("[search-analytics] sending view_search_results",e),window.gtag("event","view_search_results",e)}catch(e){a&&console.debug("[search-analytics] failed",e)}else a&&console.debug("[search-analytics] gtag unavailable; event queued implicitly by stub? term=",o);e.committed=!0}function d(){l("success")}function o(){l("abandoned"),e.lastNonEmptyTerm=""}function s(e){const t=document.createElement("div");return t.textContent=e??"",t.innerHTML}function c(e){if(e==null)return"";const t=document.createElement("textarea");return t.innerHTML=String(e),t.value}function t(e){return String(e??"").toLowerCase().replace(/[\u2019\u2018]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u00A0/g," ")}function u(e,n){const o=String(e??"");if(!n)return s(o);const d=t(o),a=t(n).trim();if(!a)return s(o);const c=[];let l=0;for(;!0;){const e=d.indexOf(a,l);if(e<0)break;c.push([e,e+a.length]),l=e+Math.max(1,a.length)}if(!c.length)return s(o);let r="",i=0;for(const[e,t]of c)e>i&&(r+=s(o.slice(i,e))),r+="<mark>"+s(o.slice(e,t))+"</mark>",i=t;return i<o.length&&(r+=s(o.slice(i))),r}function b(e,n,s=60,o=240){if(!e)return"";const i=String(e),d=t(i),r=t(n||""),c=r?d.indexOf(r):-1;if(c<0)return i.slice(0,o);const a=Math.max(0,c-s),l=Math.min(i.length,a+o),u=a>0?"…":"",h=l<i.length?"…":"";return u+i.slice(a,l)+h}function h(s,o){const i=document.getElementById("search-results"),r=document.getElementById("search-count"),c=i.getAttribute("data-card-border")||"",l=i.getAttribute("data-card-bg")||"";i.innerHTML="",r.textContent=`${s.length} result${s.length===1?"":"s"}`;const d=n(e.lastTerm);if(e.lastTerm=o||"",e.lastResultsCount=s.length,e.committed&&n(e.lastTerm)!==d&&(e.committed=!1),!s.length){const e=document.createElement("li");e.className="text-gray-500 dark:text-gray-400 text-center py-6",e.textContent="No results found.",i.appendChild(e);return}const a=document.createDocumentFragment();for(const e of s){const n=t(o||""),i=e.summary||"",d=e.content||"",h=n&&t(i).includes(n),m=h?i:d,f=n?b(m,o,60,240):(i||d).slice(0,240),r=document.createElement("li");r.className=`rounded-lg shadow-sm overflow-hidden ${c} ${l}`.trim(),r.innerHTML=`
        <a href="${e.permalink}" class="no-underline block p-5">
          <h3 class="text-lg md:text-xl font-semibold leading-snug text-gray-900 dark:text-white">${u(e.title||"Untitled",o)}</h3>
          <p class="mt-2 text-[0.95rem] text-gray-700 dark:text-gray-300 clamp-2">${u(f||"",o)}</p>
        </a>`,a.appendChild(r)}i.appendChild(a)}function m(e,n){if(!n)return[];const s=t(n).trim();return s?e.filter(e=>{const n=t((e.title||"")+" "+(e.summary||"")+" "+(e.content||""));return n.includes(s)}).slice(0,100):[]}async function f(){const t=document.getElementById("search-input"),u=document.getElementById("search-form"),a=document.getElementById("search-results");let s=[];try{const e=await fetch(r,{credentials:"omit"});s=await e.json(),s=s.map(e=>({...e,title:c(e.title),summary:c(e.summary),content:c(e.content)}))}catch{document.getElementById("search-results").innerHTML='<li class="text-red-600 dark:text-red-400">Failed to load index.json</li>';return}i&&(t.value=i,h(m(s,i),i));function l(){const a=t.value,i=n(a);i&&i.length>e.lastNonEmptyTerm.length&&(e.lastNonEmptyTerm=i);const r=e.lastNonEmptyTerm;h(m(s,a),a),!i&&!e.committed&&r&&r.length>=3&&(e.lastTerm=r,o())}t.addEventListener("input",l),u.addEventListener("submit",e=>{e.preventDefault(),l(),history.replaceState(null,"",`?q=${encodeURIComponent(t.value)}`)}),a.addEventListener("click",t=>{const n=t.target.closest("a");if(!n)return;if(e.committed)return;d(),t.button===0&&!n.target&&(t.preventDefault(),setTimeout(()=>{window.location.href=n.href},40))}),a.addEventListener("auxclick",t=>{const n=t.target.closest("a");if(!n)return;e.committed||d()}),window.addEventListener("pagehide",()=>{!e.committed&&n(e.lastTerm)&&o()}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&!e.committed&&n(e.lastTerm)&&o()}),window.addEventListener("beforeunload",()=>{!e.committed&&n(e.lastTerm)&&o()}),t.addEventListener("keydown",t=>{t.key==="Escape"&&!e.committed&&n(e.lastTerm)&&o()})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",f,{once:!0}):f()})()