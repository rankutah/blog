{{/* Contact form that posts to your Worker.
     - Reads messages and optional endpoint from site params.
     - No action="" attribute (JS handles submission).
     - No ?domain= needed: Worker reads Origin and fetches /forms.json from the site.
*/}}

{{- $endpoint := or site.Params.form.endpoint "https://form-sender.benjamin-0e3.workers.dev/submit" -}}
{{- $success  := or site.Params.form.successMessage "Thanks! We received your message." -}}
{{- $error    := or site.Params.form.errorMessage   "Something went wrong. Please try again." -}}

<div class="not-prose">
  <form id="contact-form" class="space-y-6" novalidate>
    <div>
      <label for="cf-email" class="block mb-2 text-sm font-medium">Your email</label>
      <input type="email" id="cf-email" name="email" required
             class="block w-full rounded-lg border p-2.5 text-sm" placeholder="you@example.com">
    </div>
    <div>
      <label for="cf-subject" class="block mb-2 text-sm font-medium">Subject</label>
      <input type="text" id="cf-subject" name="subject"
             class="block w-full rounded-lg border p-3 text-sm" placeholder="How can we help?">
    </div>
    <div>
      <label for="cf-name" class="block mb-2 text-sm font-medium">Your name (optional)</label>
      <input type="text" id="cf-name" name="name"
             class="block w-full rounded-lg border p-3 text-sm" placeholder="Jane Doe">
    </div>
    <div>
      <label for="cf-message" class="block mb-2 text-sm font-medium">Your message</label>
      <textarea id="cf-message" name="message" rows="6" required
                class="block w-full rounded-lg border p-2.5 text-sm" placeholder="Leave a comment..."></textarea>
    </div>

    <button type="submit" class="py-3 px-5 text-sm font-medium text-white rounded-lg bg-blue-700 hover:bg-blue-800">
      Send message
    </button>

    <p id="contact-msg" class="mt-3 text-sm"></p>
  </form>
</div>

<script>
(function(){
  const ENDPOINT = "{{ $endpoint }}"; // absolute; no ?domain needed
  const form = document.getElementById('contact-form');
  const msg  = document.getElementById('contact-msg');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    msg.textContent = "";
    const data = Object.fromEntries(new FormData(form).entries());

    try {
      const res  = await fetch(ENDPOINT, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        mode: 'cors',
        credentials: 'omit',
        body: JSON.stringify(data)
      });
      const json = await res.json().catch(() => ({}));
      if (res.ok && json.ok) {
        msg.textContent = "{{ $success }}";
        form.reset();
      } else {
        msg.textContent = json.error || "{{ $error }}";
      }
    } catch (err) {
      msg.textContent = "{{ $error }}";
    }
  });
})();
</script>
