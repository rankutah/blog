{{/* optimized-logo.html
  Inputs (dict):
    - Site: .Site or a Page (we only use . for relURL)
    - Logo: string path, e.g. "logo.png" or "/logo.png"
    - Class: optional classes for img
    - Alt: alt text
    - Width: optional width (number or string)
    - Height: optional height (number or string)

  Behavior:
    - Try to locate the logo in Hugo assets via resources.Get (media/Logo or raw Logo path).
    - If found and is image: emit <picture> with AVIF + source fallback and explicit width/height.
    - Else: fall back to a plain <img> referencing the provided logo path (static file).
*/}}
{{- $ctx   := . -}}
{{- $logo  := $ctx.Logo | default "logo.png" -}}
{{- $class := $ctx.Class | default "" -}}
{{- $alt   := $ctx.Alt   | default "logo" -}}
{{- $w     := $ctx.Width | default "" -}}
{{- $h     := $ctx.Height | default "" -}}

{{- /* Normalize path for resource lookup */ -}}
{{- $raw := strings.TrimPrefix "/" $logo -}}
{{- $orig := resources.Get (printf "media/%s" $raw) -}}
{{- if not $orig -}}
  {{- $orig = resources.Get $raw -}}
{{- end -}}

{{- /* Also detect static fallback presence to avoid 404s when param is set but file is missing */ -}}
{{- $hasStatic := or (fileExists (printf "static/%s" $raw)) (fileExists $raw) -}}

{{- if and $orig (eq $orig.MediaType.Type "image") -}}
  {{- /* Resize to target width if provided; default modest width to avoid huge header logos */ -}}
  {{- $fitW := cond $w (printf "%sx" $w) "512x" -}}
  {{- $avif  := $orig.Fit (printf "%s avif" $fitW) -}}
  {{- $webp  := $orig.Fit (printf "%s webp" $fitW) -}}
  {{- /* Derive width/height if not provided, using the fallback source */ -}}
  {{- $iw := or $w $webp.Width -}}
  {{- $ih := or $h (div (mul $webp.Height (int $iw)) $webp.Width) -}}
  <picture>
    <source srcset="{{ $avif.RelPermalink }}" type="image/avif">
    <source srcset="{{ $webp.RelPermalink }}" type="image/webp">
    <img
      src="{{ $webp.RelPermalink }}"
      alt="{{ $alt }}"
      class="{{ $class }}"
  width="{{ $iw }}"
  height="{{ $ih }}"
      loading="eager"
      fetchpriority="high"
      decoding="async" />
  </picture>
{{- else if $hasStatic -}}
  <img
    src="{{ $logo | relURL }}"
    alt="{{ $alt }}"
    class="{{ $class }}"
    {{ with $w }}width="{{ . }}"{{ end }}
    {{ with $h }}height="{{ . }}"{{ end }}
    loading="eager"
    fetchpriority="high"
    decoding="async" />
{{- end -}}
