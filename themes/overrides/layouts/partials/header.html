{{- /* themeâ€‘toggle script based on defaultTheme & localStorage */ -}}
{{- if (not site.Params.disableThemeToggle) }}
  {{- if eq site.Params.defaultTheme "light" }}
<script>
  if (localStorage.getItem("pref-theme") === "dark") {
    document.body.classList.add('dark');
  }
</script>
  {{- else if eq site.Params.defaultTheme "dark" }}
<script>
  if (localStorage.getItem("pref-theme") === "light") {
    document.body.classList.remove('dark');
  }
</script>
  {{- else }}
<script>
  if (localStorage.getItem("pref-theme") === "dark") {
    document.body.classList.add('dark');
  } else if (localStorage.getItem("pref-theme") === "light") {
    document.body.classList.remove('dark');
  } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
    document.body.classList.add('dark');
  }
</script>
  {{- end }}
{{- else if and (ne site.Params.defaultTheme "light") (ne site.Params.defaultTheme "dark") }}
<script>
  if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
    document.body.classList.add('dark');
  }
</script>
{{- end }}

<header class="header">
  <nav class="nav">
    <div class="logo">
      {{- $label_text := (site.Params.label.text | default site.Title) }}
      {{- if site.Title }}
      <a href="{{ "/" | absLangURL }}" accesskey="h" title="{{ $label_text }} (Alt + H)">
        {{- if site.Params.label.icon }}
        {{- $img := resources.Get site.Params.label.icon }}
        {{- if $img }}
          {{- $fmts := (slice "jpg" "jpeg" "png" "tif" "bmp" "gif") }}
          {{- if hugo.IsExtended }}{{- $fmts = $fmts | append "webp" }}{{- end }}
          {{- $prod := or hugo.IsProduction (eq site.Params.env "production") }}
          {{- if and (in $fmts $img.MediaType.SubType) $prod }}
            {{- if site.Params.label.iconHeight }}
              {{- $img = $img.Resize (printf "x%d" site.Params.label.iconHeight) }}
            {{- else }}
              {{- $img = $img.Resize "x30" }}
            {{- end }}
          {{- end }}
          <img src="{{ $img.Permalink }}" alt="" aria-label="logo"
               height="{{ site.Params.label.iconHeight | default "30" }}">
        {{- else }}
          <img src="{{ site.Params.label.icon | absURL }}" alt="" aria-label="logo"
               height="{{ site.Params.label.iconHeight | default "30" }}">
        {{- end }}
        {{- else if hasPrefix site.Params.label.iconSVG "<svg" }}
          {{ site.Params.label.iconSVG | safeHTML }}
        {{- end }}
        {{- $label_text }}
      </a>
      {{- end }}

      <div class="logo-switches">
        {{- if not site.Params.disableThemeToggle }}
        <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
          <svg id="moon-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path d="M17.293 13.293A8 8 0 116.707 2.707a8.003 8.003 0 0010.586 10.586z"/>
          </svg>
          <svg id="sun-icon"  class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd"
                  d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4.22 1.78a1 1 0
                     011.42 1.42l-.71.71a1 1 0 11-1.42-1.42l.71-.71zM18 9a1 1 0 100
                     2h-1a1 1 0 100-2h1zM4 10a1 1 0 100-2H3a1 1 0 100 2h1zm1.64-5.64a1
                     1 0 00-1.42 1.42l.71.71a1 1 0 001.42-1.42l-.71-.71zM10 18a1 1 0
                     100-2v1a1 1 0 000 2v-1zm-4.22 1.22a1 1 0 001.42-1.42l-.71-.71a1
                     1 0 10-1.42 1.42l.71.71zM14.36 17.36a1 1 0 001.42-1.42l-.71-.71a1
                     1 0 00-1.42 1.42l.71.71z"
                  clip-rule="evenodd"/>
          </svg>
        </button>
        {{- end }}

        {{- $lang := .Lang }}
        {{- $sep := or $label_text (not site.Params.disableThemeToggle) }}
        {{- with site.Home.Translations }}
        <ul class="lang-switch">
          {{- if $sep }}<li>|</li>{{- end }}
          {{- range . }}
            {{- if ne $lang .Lang }}
            <li>
              <a href="{{ .Permalink }}"
                 title="{{ .Language.Params.languageAltTitle | default (.Language.LanguageName | emojify) | default (.Lang | title) }}"
                 aria-label="{{ .Language.LanguageName | default (.Lang | title) }}">
                {{- if and site.Params.displayFullLangName (.Language.LanguageName) -}}
                  {{ .Language.LanguageName | emojify }}
                {{- else -}}
                  {{ .Lang | title }}
                {{- end }}
              </a>
            </li>
            {{- end }}
          {{- end }}
        </ul>
        {{- end }}
      </div>
    </div>

    {{- $currentPage := . }}
    <ul id="menu">
      {{- range site.Menus.main }}
      {{- $url1 := cond (strings.HasSuffix .URL "/") .URL (printf "%s/" .URL) | absLangURL }}
      {{- $url2 := $currentPage.Permalink | absLangURL }}
      {{- $is_search := eq (site.GetPage .KeyName).Layout "search" }}
      <li>
        <a href="{{ .URL | absLangURL }}"
           title="{{ .Title | default .Name }}{{ if $is_search }} (Alt + /){{ end }}"
           {{ if $is_search }}accesskey="/"{{ end }}
           class="inline-flex items-center">
          <span class="flex-shrink-0{{ if eq $url1 $url2 }} active{{ end }}">
            {{ .Pre }}{{ .Name }}{{ .Post }}
          </span>
          {{- if findRE "://" .URL }}
            <svg class="ml-1 align-middle flex-shrink-0" fill="none" shape-rendering="geometricPrecision"
                 stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                 viewBox="0 0 24 24" height="12" width="12">
              <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/>
              <path d="M15 3h6v6"/>
              <path d="M10 14L21 3"/>
            </svg>
          {{- end }}
        </a>
      </li>
      {{- end }}
    </ul>
  </nav>
</header>
