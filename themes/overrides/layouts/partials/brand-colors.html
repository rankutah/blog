{{/*
  Config-driven brand color overrides for buttons and links

  Usage in site config (TOML):
  [params]
    brandHex = "#6a8d6f"  # any CSS color; hex recommended

  Effects:
  - Defines CSS variables for base brand color and common variants using color-mix
  - Overrides .ui-btn backgrounds and hover/focus rings to use brand color
  - Overrides brand links (a.link-brand and .brand-link hovers in nav/menus)

  Notes:
  - We rely on !important to beat Tailwind utility classes (e.g., bg-emerald-700)
  - color-mix is widely supported; we provide sane fallbacks via base color
*/}}

{{- $hexRaw := .Site.Params.brandHex | default "" -}}
{{- $hex := $hexRaw -}}
{{- if and (ne $hexRaw "") (not (strings.HasPrefix (lower $hexRaw) "#")) -}}
  {{- $hex = printf "#%s" $hexRaw -}}
{{- end -}}

{{- if $hex }}
<style>
  :root{
    --brand: {{ $hex }};
    /* Variants using color-mix (oklab when available) */
    --brand-600: var(--brand);
    /* Hover (darker) */
    --brand-700: color-mix(in srgb, var(--brand) 88%, black);
    --brand-800: color-mix(in srgb, var(--brand) 80%, black);
    /* Focus ring (lighter) */
    --brand-300: color-mix(in srgb, var(--brand) 70%, white);
  }

  /* Prefer OKLCH/OKLAB mixing where supported for perceptual steps */
  @supports (color: color-mix(in oklab, white, black)){
    :root{
      --brand-700: color-mix(in oklab, var(--brand) 88%, black);
      --brand-800: color-mix(in oklab, var(--brand) 80%, black);
      --brand-300: color-mix(in oklab, var(--brand) 70%, white);
    }
  }

  /* Buttons */
  .ui-btn { background-color: var(--brand) !important; color: #fff !important; border-color: transparent !important; }
  .ui-btn:hover { background-color: var(--brand-700) !important; }
  .dark .ui-btn { background-color: var(--brand) !important; }
  .dark .ui-btn:hover { background-color: var(--brand-800) !important; }
  .ui-btn:focus, .ui-btn:focus-visible { outline: none !important; box-shadow: 0 0 0 4px color-mix(in srgb, var(--brand-300) 100%, transparent) !important; }
  @supports (color: color-mix(in oklab, white, black)){
    .ui-btn:focus, .ui-btn:focus-visible { box-shadow: 0 0 0 4px color-mix(in oklab, var(--brand-300) 100%, transparent) !important; }
  }

  /* Links generated by render-link and explicit brand-link elements */
  a.link-brand { color: var(--brand) !important; }
  a.link-brand:hover { color: var(--brand-700) !important; }
  .dark a.link-brand:hover { color: var(--brand-300) !important; }

  /* Navigation brand links (hover states) */
  nav .brand-link:hover { color: var(--brand-700) !important; }
  @media (min-width: 768px) {
    /* Match md:hover:* behavior */
    nav .brand-link:hover { color: var(--brand-700) !important; }
  }
  .dark nav .brand-link:hover { color: var(--brand-300) !important; }

  /* Optional: simple button class aliases if used elsewhere */
  .btn-brand { background-color: var(--brand) !important; color: #fff !important; }
  .btn-brand:hover { background-color: var(--brand-700) !important; }
</style>
{{- end }}
