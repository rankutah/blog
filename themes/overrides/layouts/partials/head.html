<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="color-scheme" content="light dark">
{{- if hugo.IsProduction | or (eq site.Params.env "production") | and (ne .Params.robotsNoIndex true) }}
<meta name="robots" content="index, follow">
{{- else }}
<meta name="robots" content="noindex, nofollow">
{{- end }}

{{- /* Title */}}
<title>{{ if .IsHome }}{{ else }}{{ if .Title }}{{ .Title }} | {{ end }}{{ end }}{{ site.Title }}</title>

{{- /* Meta */}}
{{- if .IsHome }}
  {{ with site.Params.keywords -}}
    <meta name="keywords" content="{{- range $i, $e := . }}{{ if $i }}, {{ end }}{{ $e }}{{ end }}">
  {{ end }}
{{- else }}
  <meta name="keywords" content="{{ if .Params.keywords -}}
      {{- range $i, $e := .Params.keywords }}{{ if $i }}, {{ end }}{{ $e }}{{ end }}{{- else -}}
      {{- range $i, $e := .Params.tags }}{{ if $i }}, {{ end }}{{ $e }}{{ end }}{{- end -}}">
{{- end }}
<meta name="description" content="{{- with .Description }}{{ . }}{{- else }}{{- if or .IsPage .IsSection }}
    {{- .Summary | default (printf "%s - %s" .Title site.Title) }}{{- else }}
    {{- with site.Params.description }}{{ . }}{{- end }}{{- end }}{{- end -}}">
<meta name="author" content="{{ partial "author.html" . }}">
<link rel="canonical" href="{{ if .Params.canonicalURL -}} {{ trim .Params.canonicalURL " " }} {{- else -}} {{ .Permalink }} {{- end }}">
{{- /* Networking hints for GA only when loading immediately (no delay) */}}
{{- $gaDelay := site.Params.analytics.delayMs | default 5000 -}}
{{- $gaImmediate := eq $gaDelay 0 -}}
{{- if $gaImmediate -}}
  {{- with site.Params.analytics.google.id }}
  <link rel="dns-prefetch" href="//www.googletagmanager.com">
  <link rel="dns-prefetch" href="//www.google-analytics.com">
  <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
  <link rel="preconnect" href="https://www.google-analytics.com" crossorigin>
  {{- end -}}
{{- end }}
{{- if site.Params.analytics.google.SiteVerificationTag }}
<meta name="google-site-verification" content="{{ site.Params.analytics.google.SiteVerificationTag }}">
{{- end }}
{{- if site.Params.analytics.yandex.SiteVerificationTag }}
<meta name="yandex-verification" content="{{ site.Params.analytics.yandex.SiteVerificationTag }}">
{{- end }}
{{- if site.Params.analytics.bing.SiteVerificationTag }}
<meta name="msvalidate.01" content="{{ site.Params.analytics.bing.SiteVerificationTag }}">
{{- end }}
{{- if site.Params.analytics.naver.SiteVerificationTag }}
<meta name="naver-site-verification" content="{{ site.Params.analytics.naver.SiteVerificationTag }}">
{{- end }}

{{- /* Styles */}}
{{- /* Only run PaperMod CSS pipeline when assets exist */}}
{{- $__pm_has := or (resources.Get "css/core/reset.css") (resources.Get "css/core/theme-vars.css") (gt (len (resources.Match "css/common/*.css")) 0) }}
{{- if $__pm_has }}
{{- /* includes */}}
{{- $includes := slice (" " | resources.FromString "assets/css/includes-blank.css") }}
{{- if not (eq site.Params.assets.disableScrollBarStyle true) }}
  {{- $ScrollStyle := resources.Get "css/includes/scroll-bar.css" }}
  {{- if $ScrollStyle }}
    {{- $includes = $includes | append $ScrollStyle }}
  {{- end }}
{{- end }}
{{- $includes_all := $includes | resources.Concat "assets/css/includes.css" }}
{{- $theme_vars := resources.Get "css/core/theme-vars.css" }}
{{- $reset := resources.Get "css/core/reset.css" }}
{{- $media := resources.Get "css/core/zmedia.css" }}
{{- $license_css := resources.Get "css/core/license.css" }}
{{- $commonMatches := resources.Match "css/common/*.css" }}
{{- $common := cond (gt (len $commonMatches) 0) ($commonMatches | resources.Concat "assets/css/common.css") (" " | resources.FromString "assets/css/common.css") }}
{{- $chroma_styles := resources.Get "css/includes/chroma-styles.css" }}
{{- $chroma_mod := resources.Get "css/includes/chroma-mod.css" }}

{{- /* Build core parts only from existing resources */}}
{{- $coreParts := slice $includes_all }}
{{- if $theme_vars }}{{- $coreParts = $coreParts | append $theme_vars }}{{- end }}
{{- if $reset }}{{- $coreParts = $coreParts | append $reset }}{{- end }}
{{- $coreParts = $coreParts | append $common }}
{{- if $chroma_styles }}{{- $coreParts = $coreParts | append $chroma_styles }}{{- end }}
{{- if $chroma_mod }}{{- $coreParts = $coreParts | append $chroma_mod }}{{- end }}
{{- if $media }}{{- $coreParts = $coreParts | append $media }}{{- end }}
{{- $core := $coreParts | resources.Concat "assets/css/core.css" | resources.Minify }}

{{- $extendedMatches := resources.Match "css/extended/*.css" }}
{{- $extended := cond (gt (len $extendedMatches) 0) ($extendedMatches | resources.Concat "assets/css/extended.css" | resources.Minify) (" " | resources.FromString "assets/css/extended.css") }}

{{- /* Build final stylesheet parts safely */}}
{{- $sheetParts := slice $core $extended }}
{{- if $license_css }}{{- $sheetParts = $sheetParts | append $license_css }}{{- end }}
{{- $stylesheet := $sheetParts | resources.Concat "assets/css/stylesheet.css" }}

{{- if not site.Params.assets.disableFingerprinting }}
  {{- $stylesheet = $stylesheet | fingerprint }}
  <link crossorigin="anonymous"
        href="{{ $stylesheet.RelPermalink }}"
        integrity="{{ $stylesheet.Data.Integrity }}"
        rel="preload stylesheet"
        as="style">
{{- else }}
  <link crossorigin="anonymous"
        href="{{ $stylesheet.RelPermalink }}"
        rel="preload stylesheet"
        as="style">
{{- end }}
{{- end }}

{{/* PaperMod pages should not include Tailwind/Flowbite CSS here. Flowbite CSS is loaded exclusively by flowbite.html base. */}}

{{- /* Add taxonomy badge CSS here */}}
{{ partial "taxonomy-badges.html" . }}

{{- /* Search */}}
{{- if (eq .Layout `search`) -}}
  <link crossorigin="anonymous" rel="preload" as="fetch" href="../index.json">
  {{- $fastsearch := resources.Get "js/fastsearch.js" | js.Build (dict "params" (dict "fuseOpts" site.Params.fuseOpts)) | resources.Minify }}
  {{- $fusejs := resources.Get "js/fuse.basic.min.js" }}
  {{- $license_js := resources.Get "js/license.js" }}
  {{- if not site.Params.assets.disableFingerprinting }}
    {{- $search := (slice $fusejs $license_js $fastsearch ) | resources.Concat "assets/js/search.js" | fingerprint }}
    <script defer crossorigin="anonymous" src="{{ $search.RelPermalink }}" integrity="{{ $search.Data.Integrity }}"></script>
  {{- else }}
    {{- $search := (slice $fusejs $fastsearch ) | resources.Concat "assets/js/search.js" }}
    <script defer crossorigin="anonymous" src="{{ $search.RelPermalink }}"></script>
  {{- end }}
{{- end -}}

{{- /* Favicons */}}
{{ partial "favicons.html" . }}
<meta name="theme-color" content="{{ site.Params.assets.theme_color | default "#2e2e33" }}">
<meta name="msapplication-TileColor" content="{{ site.Params.assets.msapplication_TileColor | default "#2e2e33" }}">

{{- /* RSS / Alternate links */}}
{{ range .AlternativeOutputFormats -}}
  <link rel="{{ .Rel }}" type="{{ .MediaType.Type }}" href="{{ .Permalink }}">
{{- end -}}
{{- range .AllTranslations -}}
  <link rel="alternate" hreflang="{{ .Lang }}" href="{{ .Permalink }}">
{{- end -}}

<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }
    </style>
    {{- if (and (ne site.Params.defaultTheme "light") (ne site.Params.defaultTheme "dark")) }}
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196,197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }
    </style>
    {{- end }}
</noscript>

{{- partial "extend_head.html" . -}}
{{- /* LCP image preload: prefer AVIF source; only emit if we find a clean URL */ -}}
{{- if or .IsHome .Params.hero -}}
  {{- /* Try to find the first <source type="image/avif" ... srcset="..."> */ -}}
  {{- $avifTags := findRE `(?is)<source[^>]+type=\"image/avif\"[^>]+srcset=\"[^\"]+\"` .Content -}}
  {{- $imgTags  := findRE `(?is)<img[^>]+src=\"[^\"]+\"` .Content -}}
  {{- $lcp := "" -}}
  {{- if or (gt (len $avifTags) 0) (gt (len $imgTags) 0) -}}
    {{- /* LCP preload */ -}}
    {{ partial "lcp-preload.html" . }}
  {{- end -}}
{{- end -}}
{{ partial "schema.html" . }}

{{- /* Misc: analytics & social previews */}}
{{- if hugo.IsProduction | or (eq site.Params.env "production") }}
  {{ partial "google_analytics.html" . }}

  {{- /* Prefer a full-bleed hero/carousel <img>. */ -}}
  {{- $heroImg := replaceRE `(?is).*<img[^>]+class=\"[^\"]*absolute[^\"]*inset-0[^\"]*w-full[^\"]*h-full[^\"]*\"[^>]+src=\"([^\"]+)\".*` "${1}" .Content -}}
  {{- /* Fallback: first <img> anywhere */ -}}
  {{- $firstImg := cond (ne $heroImg "") $heroImg (replaceRE `(?is).*<img[^>]+src=\"([^\"]+)\".*` "${1}" .Content) -}}
  {{- /* Homepage hero via section shortcode img="..." if no <img> found */ -}}
  {{- if and .IsHome (eq $firstImg "") -}}
    {{- $secMatch := findRE `(?is)\{\{<\s*section[^>]*img\s*=\s*\"([^\"]+)\"[^>]*>\}\}` .RawContent -}}
    {{- if gt (len $secMatch) 0 -}}
      {{- $firstImg = replaceRE `(?is).*img\s*=\s*\"([^\"]+)\".*` "${1}" (index $secMatch 0) -}}
    {{- end -}}
  {{- end -}}
  {{- /* Absolute URL for social */ -}}
  {{- if $firstImg -}}
    {{- $ogAbs := cond (hasPrefix $firstImg "http") $firstImg (absURL $firstImg) -}}
    <meta property="og:image" content="{{ $ogAbs }}" />
    <meta name="twitter:image" content="{{ $ogAbs }}" />
  {{- end -}}

  {{- if templates.Exists "partials/templates/opengraph.html" -}}
    {{ partial "templates/opengraph.html" . | safeHTML }}
  {{- end -}}
  {{- if templates.Exists "partials/templates/twitter_cards.html" -}}
    {{ partial "templates/twitter_cards.html" . }}
  {{- end -}}
{{- end -}}
