{{/*
  Config-driven font overrides

  Usage in site config (TOML):
  [params.fonts]
    # Optional: raw Google Fonts CSS2 query string (everything after `css2?`)
    # Example: "family=Playfair+Display:wght@400;700&family=Inter:wght@400;600;700&display=swap"
    load   = ""
    body   = "ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji"
    heading= "ui-serif,Georgia,Times New Roman,Times,serif"
    navBrand = "inherit"  # falls back to heading if set to "inherit"
    navLink  = "inherit"  # falls back to body if set to "inherit"
    button   = "inherit"  # falls back to body if set to "inherit"

  This partial emits (1) optional font <link> and (2) a <style> with CSS variables and targeted overrides.
*/}}

{{- $fonts := .Site.Params.fonts | default dict -}}
{{- $load  := (index $fonts "load") | default "" -}}
{{- $body  := (index $fonts "body") | default `ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji` -}}
{{- $heading := (index $fonts "heading") | default `ui-serif,Georgia,Times New Roman,Times,serif` -}}
{{- $navBrand := (index $fonts "navBrand") | default "inherit" -}}
{{- $navLink  := (index $fonts "navLink")  | default "inherit" -}}
{{- $button   := (index $fonts "button")   | default "inherit" -}}
{{- $useLocalCinzel := (index $fonts "localCinzel") | default false -}}

{{/* If a site declares fonts.load, prefer the vendored local CSS produced by scripts/vendor-google-fonts.mjs */}}
{{- if $load }}
  {{- $ver := printf "%d" (now.Unix) -}}
  <link rel="preload" as="style" href="/fonts/google/fonts.css?v={{ $ver }}">
  <link rel="stylesheet" href="/fonts/google/fonts.css?v={{ $ver }}">
{{- end }}

{{- if $useLocalCinzel }}
  <style>
    @font-face {
      font-family: 'Cinzel';
      src: url('/fonts/cinzel/Cinzel-Regular.woff2') format('woff2');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }
  </style>
{{- end }}

<style>
  :root{
    --font-body: {{ printf "%s" $body | safeCSS }};
    --font-heading: {{ printf "%s" $heading | safeCSS }};
    --font-nav-brand: {{ if eq $navBrand "inherit" }}var(--font-heading){{ else }}{{ printf "%s" $navBrand | safeCSS }}{{ end }};
    --font-nav-link: {{ if eq $navLink "inherit" }}var(--font-body){{ else }}{{ printf "%s" $navLink | safeCSS }}{{ end }};
    --font-button: {{ if eq $button "inherit" }}var(--font-body){{ else }}{{ printf "%s" $button | safeCSS }}{{ end }};
  }

  /* Apply body and heading families broadly */
  body { font-family: var(--font-body), ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans, sans-serif; }

  :where(h1,h2,h3,h4,h5,h6),
  .prose :where(h1,h2,h3,h4,h5,h6) {
    font-family: var(--font-heading), ui-serif, Georgia, Times New Roman, Times, serif !important;
    font-weight: 400 !important; /* enforce regular weight for all headings */
  }

  /* Navbar brand title (span right after logo) */
  nav a > span.font-semibold {
    font-family: var(--font-nav-brand), var(--font-heading), ui-serif, Georgia, Times New Roman, Times, serif !important;
    font-weight: 400 !important; /* regular weight for brand */
  }

  /* Navbar links (brand-link class used in navbar.html) */
  nav .brand-link { font-family: var(--font-nav-link), var(--font-body), ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans, sans-serif; }

  /* Ensure any Tailwind "font-serif" usages pick up the heading family instead of default Times */
  .font-serif { font-family: var(--font-heading), ui-serif, Georgia, Times New Roman, Times, serif !important; }

  /* Buttons: our UI button class plus native buttons (safe) */
  .ui-btn,
  button,
  [role="button"],
  a.button,
  a.btn { font-family: var(--font-button), var(--font-body), ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans, sans-serif; }

  /* Utility: Cinzel regular */
  .font-cinzel { font-family: 'Cinzel', ui-serif, Georgia, 'Times New Roman', Times, serif !important; font-weight: 400 !important; }
  /* Increase specificity for content inside .prose blocks */
  .prose .font-cinzel { font-family: 'Cinzel', ui-serif, Georgia, 'Times New Roman', Times, serif !important; font-weight: 400 !important; }
</style>
