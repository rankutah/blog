{{- $p := .Page.Site.Params.form | default (dict) -}}
{{- $endpoint := (index $p "endpoint" | default "") -}}
{{- $okMsg := (index $p "successMessage" | default "Thanks! Your message was sent.") -}}
{{- $errMsg := (index $p "errorMessage"   | default "Network error. Please try again.") -}}

<div class="not-prose max-w-screen-md mx-auto">
  <form id="contactForm" class="space-y-6">
    <div>
      <label for="cf-email" class="block mb-2 text-sm font-medium">Your email</label>
      <input id="cf-email" type="email" required class="block w-full rounded-lg border p-2.5" placeholder="you@example.com">
    </div>

    <div>
      <label for="cf-subject" class="block mb-2 text-sm font-medium">Subject</label>
      <input id="cf-subject" type="text" class="block w-full rounded-lg border p-2.5" placeholder="Let us know how we can help you">
    </div>

    <div>
      <label for="cf-name" class="block mb-2 text-sm font-medium">Your name (optional)</label>
      <input id="cf-name" type="text" class="block w-full rounded-lg border p-2.5" placeholder="Jane Doe">
    </div>

    <div class="sm:col-span-2">
      <label for="cf-message" class="block mb-2 text-sm font-medium">Your message</label>
      <textarea id="cf-message" rows="6" required class="block w-full rounded-lg border p-2.5" placeholder="Type your message..."></textarea>
    </div>

    <button id="cf-submit" type="submit" class="py-3 px-5 text-sm font-medium text-center text-white rounded-lg bg-blue-700 hover:bg-blue-800 focus:ring-4">
      Send message
    </button>

    <p id="cf-status" class="text-sm mt-2"></p>
  </form>
</div>

<script>
(() => {
  const ENDPOINT = {{ $endpoint | jsonify }};
  const okMsg    = {{ $okMsg | jsonify }};
  const errMsg   = {{ $errMsg | jsonify }};

  document.getElementById("contactForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const status = document.getElementById("cf-status");
    status.textContent = "";
    const btn = document.getElementById("cf-submit");
    btn.disabled = true;

    try {
      const payload = {
        name:    document.getElementById("cf-name").value.trim(),
        email:   document.getElementById("cf-email").value.trim(),
        subject: document.getElementById("cf-subject").value.trim(),
        message: document.getElementById("cf-message").value.trim(),
      };

      const res = await fetch(ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      const data = await res.json().catch(() => ({}));
      if (res.ok && data.ok) {
        status.textContent = okMsg;
        e.target.reset();
      } else {
        status.textContent = (data && data.error) ? data.error : errMsg;
      }
    } catch {
      status.textContent = errMsg;
    } finally {
      btn.disabled = false;
    }
  });
})();
</script>
