{{- $name := .Get "name" -}}
{{- $alt := .Get "alt" | default $name -}}
{{- $variant := .Get "variant" | default "" -}}
{{- $size := .Get "size" | default "40" -}} {{/* spacing token OR 'full' */}}
{{- $height := .Get "height" | default "" -}} {{/* when set, forces fixed height with full width */}}
{{- $zoom := .Get "zoom" | default "1" -}}
{{- $focus := .Get "focus" | default "center" -}}
{{- $exts := slice "avif" "webp" "jpg" "jpeg" "png" "JPG" "JPEG" "PNG" -}}
{{- $dirs := slice "media/staff" "media" -}}
{{- $src := "" -}}
{{- range $dirs -}}
  {{- $d := . -}}
  {{- range $exts -}}
    {{- $candidate := printf "%s/%s.%s" $d $name . -}}
    {{- if fileExists $candidate -}}
      {{- $src = printf "/%s/%s.%s" $d $name . -}}
      {{- break -}}
    {{- end -}}
  {{- end -}}
  {{- if $src }}{{- break -}}{{- end -}}
{{- end -}}
{{- /* Map focus param to Tailwind object-* class */ -}}
{{- $focusClass := "object-center" -}}
{{- if eq $focus "top" }}{{ $focusClass = "object-top" }}{{ end -}}
{{- if eq $focus "bottom" }}{{ $focusClass = "object-bottom" }}{{ end -}}
{{- if eq $focus "left" }}{{ $focusClass = "object-left" }}{{ end -}}
{{- if eq $focus "right" }}{{ $focusClass = "object-right" }}{{ end -}}
{{- /* Build class names for size to avoid nested template causing parse issues */ -}}
{{- $widthClass := printf "w-%s" $size -}}
{{- $heightClass := printf "h-%s" $size -}}
{{- $style := "" -}}
{{- if ne $zoom "1" -}}
  {{- $style = printf "transform:scale(%s);transform-origin:center;" $zoom -}}
{{- end -}}
{{- $isFull := or (eq $size "full") (eq $size "FULL") -}}

{{- if eq $variant "card" -}}
  {{/* Card variant (centered square): full-width inside card padding, no negative margins. */}}
  <div class="w-full aspect-square overflow-hidden mb-4">
    <img loading="lazy" decoding="async" class="w-full h-full object-cover {{ $focusClass }}" src="{{ if $src }}{{ $src | relURL }}{{ else }}{{ "/media/placeholder-staff.svg" | relURL }}{{ end }}" alt="{{ $alt }}" {{ if $style }}style="{{ $style }}"{{ end }} />
  </div>
{{- else -}}
  {{- if $isFull -}}
    {{- if ne $height "" -}}
    <div class="block w-full h-{{ $height }} overflow-hidden rounded-xl">
      <img loading="lazy" decoding="async" class="w-full h-full object-cover {{ $focusClass }}" src="{{ if $src }}{{ $src | relURL }}{{ else }}{{ "/media/placeholder-staff.svg" | relURL }}{{ end }}" alt="{{ $alt }}" {{ if $style }}style="{{ $style }}"{{ end }} />
    </div>
    {{- else -}}
    <div class="block w-full aspect-square overflow-hidden rounded-xl">
      <img loading="lazy" decoding="async" class="w-full h-full object-cover {{ $focusClass }}" src="{{ if $src }}{{ $src | relURL }}{{ else }}{{ "/media/placeholder-staff.svg" | relURL }}{{ end }}" alt="{{ $alt }}" {{ if $style }}style="{{ $style }}"{{ end }} />
    </div>
    {{- end -}}
  {{- else -}}
    {{- if ne $height "" -}}
    <div class="block w-full h-{{ $height }} overflow-hidden rounded-xl">
      <img loading="lazy" decoding="async" class="w-full h-full object-cover {{ $focusClass }}" src="{{ if $src }}{{ $src | relURL }}{{ else }}{{ "/media/placeholder-staff.svg" | relURL }}{{ end }}" alt="{{ $alt }}" {{ if $style }}style="{{ $style }}"{{ end }} />
    </div>
    {{- else -}}
    <div class="block m-0 {{ $widthClass }} {{ $heightClass }} overflow-hidden rounded-xl mx-auto">
      <img loading="lazy" decoding="async" class="w-full h-full object-cover {{ $focusClass }}" src="{{ if $src }}{{ $src | relURL }}{{ else }}{{ "/media/placeholder-staff.svg" | relURL }}{{ end }}" alt="{{ $alt }}" {{ if $style }}style="{{ $style }}"{{ end }} />
    </div>
    {{- end -}}
  {{- end -}}
{{- end -}}
