{{- /* Section with optional full-bleed hero and overlay text.
     Props:
       max="sm|md|lg|xl|2xl|full"
       pad="none|sm|md|lg"
       y="none|sm|md|lg|xl"             (base vertical spacing)
       yBottom="none|sm|md|lg|xl"       (override bottom spacing for this section only)
       align="start|center"
       classes="…"

       img="…"                          (hero image URL)
       alt="…"
       bleed="true|false"               (defaults true when img is set)
       imgClasses="…"                   (Tailwind classes for <img>)
       imgStyle="…"                     (inline CSS, e.g. "height:60vh" – always works)
       overlay="true|false"             (render .Inner over the image)
       overlayShade="…"                 (e.g. "bg-black/30")
       overlayClasses="…"               (positioning wrapper; defaults to centered)
*/ -}}

{{- $page := .Page -}}
{{- /* IMPORTANT: bind .Inner to a var so Hugo sees the token for paired shortcodes */ -}}
{{- $Inner := .Inner -}}

{{/* ---------- read layout knobs ---------- */}}
{{- $pageOverride := .Get "classes" | default "" -}}
{{- $siteOverride := $page.Site.Params.section.classes | default "" -}}

{{- $max   := .Get "max"     | default "xl"   -}}
{{- $pad   := .Get "pad"     | default "lg"   -}}
{{- $y     := .Get "y"       | default "md"   -}}
{{- $yBottom := .Get "yBottom" | default ""   -}}
{{- $align := .Get "align"   | default "start" -}}

{{- $maxMap := dict
  "sm"  "max-w-screen-sm"
  "md"  "max-w-3xl"
  "lg"  "max-w-5xl"
  "xl"  "max-w-7xl"
  "2xl" "max-w-screen-2xl"
  "full" "max-w-none"
-}}
{{- $padMap := dict "none" "px-0" "sm" "px-4" "md" "px-6" "lg" "px-8" -}}
{{- $alMap  := dict "start" "text-left" "center" "text-center" -}}

{{- $ptMap := dict "none" "pt-0" "sm" "pt-6" "md" "pt-12" "lg" "pt-16" "xl" "pt-24" -}}
{{- $pbMap := dict "none" "pb-0" "sm" "pb-6" "md" "pb-12" "lg" "pb-16" "xl" "pb-24" -}}

{{/* ---------- hero controls ---------- */}}
{{- $img        := .Get "img" | default "" -}}
{{- $alt        := .Get "alt" | default "" -}}
{{- $bleedStr   := .Get "bleed" | default "" -}}
{{- $bleed      := cond (ne $img "") (ne (lower $bleedStr) "false") false -}}
{{- $imgClasses := .Get "imgClasses" | default "block w-full h-64 md:h-80 lg:h-96 object-cover" -}}
{{- $imgStyle   := .Get "imgStyle"   | default "" -}}

{{- $overlay      := eq (lower (.Get "overlay" | default "false")) "true" -}}
{{- $overlayShade := .Get "overlayShade" | default "" -}}
{{- $overlayWrap  := .Get "overlayClasses" | default "absolute inset-0 flex items-center" -}}
{{- $overlayProse := "prose prose-zinc max-w-none dark:prose-invert" -}}
{{- $overlayAlign := (index $alMap $align | default "text-left") -}}

{{/* spacing: zero top padding if bleeding; keep bottom spacing (tweakable) */}}
{{- $pt := cond $bleed "pt-0" (index $ptMap $y | default "pt-12") -}}
{{- $pb := index $pbMap $y | default "pb-12" -}}
{{- if $yBottom }}{{- $pb = index $pbMap $yBottom | default $pb -}}{{- end -}}

{{- $container := printf "%s mx-auto %s %s %s"
    (index $maxMap $max   | default "max-w-7xl")
    (index $padMap $pad   | default "px-8")
    $pt
    (index $alMap  $align | default "text-left")
-}}
{{- $base := printf "%s %s" $container $pb -}}
{{- $classes := cond (ne $pageOverride "") $pageOverride (cond (ne $siteOverride "") $siteOverride $base) -}}

<section>
  {{- if and $img $bleed -}}
    <div class="relative left-1/2 right-1/2 ml-[-50vw] mr-[-50vw] w-screen">
      <img src="{{ $img | safeURL }}" alt="{{ $alt }}" class="not-prose {{ $imgClasses }}"{{ if $imgStyle }} style="{{ $imgStyle }}"{{ end }}>
      {{- if $overlay -}}
        <div class="{{ $overlayWrap }}">
          {{- if $overlayShade }}<div class="absolute inset-0 {{ $overlayShade }}"></div>{{- end }}
          <div class="relative z-10 w-full {{ $container }}">
            <div class="{{ $overlayProse }} {{ $overlayAlign }}">
              {{- $page.RenderString $Inner -}}
            </div>
          </div>
        </div>
      {{- end }}
    </div>

    {{- /* keep normal bottom spacing even if content was overlayed */ -}}
    {{- if $overlay -}}
      <div class="{{ (printf "%s %s" (printf "%s mx-auto %s" (index $maxMap $max | default "max-w-7xl") (index $padMap $pad | default "px-8")) $pb) }}"></div>
    {{- else -}}
      <div class="{{ $classes }}">
        {{ $page.RenderString $Inner }}
      </div>
    {{- end }}

  {{- else if $img -}}
    <div class="{{ $classes }}">
      <div class="relative">
        <img src="{{ $img | safeURL }}" alt="{{ $alt }}" class="not-prose block w-full {{ $imgClasses }}"{{ if $imgStyle }} style="{{ $imgStyle }}"{{ end }}>
        {{- if $overlay -}}
          <div class="{{ $overlayWrap }}">
            {{- if $overlayShade }}<div class="absolute inset-0 {{ $overlayShade }}"></div>{{- end }}
            <div class="relative z-10 w-full">
              <div class="{{ $overlayProse }} {{ $overlayAlign }}">
                {{ $page.RenderString $Inner }}
              </div>
            </div>
          </div>
        {{- else -}}
          <div class="{{ $overlayProse }} {{ $overlayAlign }} mt-6">
            {{ $page.RenderString $Inner }}
          </div>
        {{- end }}
      </div>
    </div>

  {{- else -}}
    <div class="{{ $classes }}">
      {{ $page.RenderString $Inner }}
    </div>
  {{- end }}
</section>
