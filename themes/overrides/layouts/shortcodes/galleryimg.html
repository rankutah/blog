{{/*
  galleryimg shortcode
  Usage: {{< galleryimg src="/media/filename.jpg" alt="Alt text" >}}

  Uses the prebuilt `data/images.manifest.json` pipeline (via partial img.manifest.html)
  so we get stable responsive srcsets without relying on Hugo Pipes image processing.
*/}}

{{- $src := .Get "src" -}}
{{- $alt := .Get "alt" | default "" -}}
{{- if not $src -}}
  {{- errorf "galleryimg shortcode requires src parameter" -}}
{{- end -}}

{{- $isAbs := or (hasPrefix $src "http://") (or (hasPrefix $src "https://") (or (hasPrefix $src "//") (hasPrefix $src "data:"))) -}}
{{- $href := cond $isAbs $src ($src | relURL) -}}

{{- $sizes := "(min-width:1280px) 25vw, (min-width:768px) 33vw, (min-width:640px) 50vw, 100vw" -}}

<div class="mb-4 p-0">
  <a href="{{ $href }}" class="group block" data-lightbox="gallery">
    {{- partial "img.manifest.html" (dict
      "src" $src
      "alt" $alt
      "loading" "lazy"
      "decoding" "async"
      "sizes" $sizes
      "class" "w-full h-auto rounded-lg shadow border border-gray-200 dark:border-gray-700"
    ) -}}
  </a>
</div>
