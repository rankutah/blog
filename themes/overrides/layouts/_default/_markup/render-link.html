{{- /* layouts/_default/_markup/render-link.html */ -}}
{{- $dest := .Destination -}}

{{- /* Site defaults for plain links */ -}}
{{- $default := `font-medium text-blue-600 dark:text-blue-500 no-underline hover:underline` -}}
{{- $linkClasses := .Page.Site.Params.text.linkClasses | default $default -}}

{{- /* Button defaults (site override → fallback). Include `centerable` so wrapper {.center} auto-centers. */ -}}
{{- $btnSolidDefault := `not-prose centerable text-white bg-rose-700 hover:bg-rose-800 focus:ring-4 focus:ring-rose-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-rose-600 dark:hover:bg-rose-700 focus:outline-none dark:focus:ring-rose-800` -}}
{{- $btnSolid := .Page.Site.Params.button.classes | default $btnSolidDefault -}}

{{- $btnOutlineDefault := `not-prose centerable text-blue-700 hover:text-white border border-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2 dark:border-blue-500 dark:text-blue-500 dark:hover:text-white dark:hover:bg-blue-500 dark:focus:ring-blue-800` -}}
{{- $btnOutline := .Page.Site.Params.button_outline.classes | default $btnOutlineDefault -}}

{{- /* Read any inline classes on the Markdown link */ -}}
{{- $attrClass := index .Attributes "class" | default "" -}}
{{- $classPadded := printf " %s " $attrClass -}}
{{- $isBtn     := in $classPadded " btn " -}}
{{- $isOutline := in $classPadded " btn-outline " -}}

{{- /* Strip our marker tokens; keep any extra classes (e.g., .center .w-full) */ -}}
{{- $extra := $attrClass -}}
{{- range $tok := (slice "btn" "btn-outline") -}}
  {{- $extra = replaceRE (printf `(?m)(^|\s)%s(\s|$)` $tok) "" $extra -}}
{{- end -}}
{{- $extra = trim $extra " " -}}

{{- /* Build href with your existing .md → pretty URL normalization */ -}}
{{- $href := .Destination -}}
{{- if and (not (or (strings.HasPrefix $dest "http://") (strings.HasPrefix $dest "https://"))) (strings.HasSuffix (lower $dest) ".md") -}}
  {{- $url := replaceRE `(?i)\.md$` "" $dest -}}
  {{- $url = replaceRE `^\.{1,2}/` "" $url -}}
  {{- if not (strings.HasPrefix $url "/") -}} {{- $url = printf "/%s" $url -}} {{- end -}}
  {{- if not (strings.HasSuffix $url "/") -}} {{- $url = printf "%s/" $url -}} {{- end -}}
  {{- $url = replaceRE "/+" "/" $url -}}
  {{- $href = $url -}}
{{- end -}}

{{- /* Choose final classes */ -}}
{{- $final := $linkClasses -}}
{{- if $isBtn -}}
  {{- $base := cond $isOutline $btnOutline $btnSolid -}}
  {{- $final = print $base (cond (ne $extra "") (print " " $extra) "") -}}
{{- end -}}

<a href="{{ $href }}" class="{{ $final }}"{{ with .Title }} title="{{ . }}"{{ end }}>{{ .Text | safeHTML }}</a>
