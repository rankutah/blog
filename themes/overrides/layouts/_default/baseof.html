<!DOCTYPE html>
{{/* Compute lightweight bg class hints for <html> so theme bootstrap can mirror color-picker behavior */}}
{{- $lightParam := lower (or .Site.Params.lightBackground "gray-200") -}}
{{- $darkParam  := lower (or .Site.Params.darkBackground  "zinc-900") -}}
{{- /* strip any prefixes */ -}}
{{- if strings.HasPrefix $lightParam "dark:bg-" -}}{{- $lightParam = replace $lightParam "dark:bg-" "" -}}{{- end -}}
{{- if strings.HasPrefix $lightParam "bg-" -}}{{- $lightParam = replace $lightParam "bg-" "" -}}{{- end -}}
{{- if strings.HasPrefix $darkParam "dark:bg-" -}}{{- $darkParam = replace $darkParam "dark:bg-" "" -}}{{- end -}}
{{- if strings.HasPrefix $darkParam "bg-" -}}{{- $darkParam = replace $darkParam "bg-" "" -}}{{- end -}}
{{- /* normalize to plain bg-* classes usable on <html> itself */ -}}
{{- $htmlLight := cond (eq $lightParam "white") "bg-white" (printf "bg-%s" $lightParam) -}}
{{- $htmlDark  := cond (eq $darkParam  "black") "bg-black" (printf "bg-%s"  $darkParam)  -}}

<html class="{{ .Site.Params.primaryColor | default "rose" }}" lang="{{ site.Language }}" dir="{{ .Language.LanguageDirection | default "auto" }}" data-force-theme="{{ .Site.Params.forceTheme }}" data-bg-light="{{ $htmlLight }}" data-bg-dark="{{ $htmlDark }}">
	<head>
		{{- partial "head.html" . -}}
		{{- partial "theme/card-border-vars.html" . -}}
	</head>
	<body id="top" class="min-h-screen flex flex-col {{ if eq site.Params.defaultTheme `dark` }}dark{{ end }}">
		{{ partial "header.html" . }}
		<main class="flex-1">
			{{- block "main" . }}{{ end }}
		</main>
		{{ partial "footer.html" . }}

		<!-- cp-debug: messageModal.enable = {{ printf "%v" (and (isset .Site.Params "messageModal") (isset .Site.Params.messageModal "enable") (.Site.Params.messageModal.enable)) }} -->
		{{/* FAB + Modal gating:
		     - If messageModal.enable = true → include FAB (modal mode) + modal markup
		     - Else if messageFab.enable = true → include FAB (link mode)
		   No BaseURL fallback to avoid surprises. */}}
		{{ $mm := .Site.Params.messageModal }}
		{{ $fab := .Site.Params.messageFab }}
		{{ $contactURL := "/contact/" | relURL }}
		{{ $hideMessageFab := or (eq .RelPermalink $contactURL) (.Param "hideMessageFab") }}
		{{ if not $hideMessageFab }}
			{{ if and $mm ($mm.enable) }}
				{{ partial "text-fab.html" . }}
				{{ partial "message-modal.html" . }}
			{{ else if and $fab ($fab.enable) }}
				{{ partial "text-fab.html" . }}
			{{ end }}
		{{ end }}
	</body>
</html>
