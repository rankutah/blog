{{/* themes/overrides/layouts/_default/flowbite.html */}}
<!DOCTYPE html>
<html class="{{ .Site.Params.brandColor | default "rose" }}" lang="{{ .Site.Language.Lang }}" dir="{{ .Site.Language.LanguageDirection | default "auto" }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ .Title }} | {{ .Site.Title }}</title>

  <!-- Dark-mode bootstrap:
       - If <html data-force-theme="dark|light"> is present, use that.
       - Otherwise follow the OS preference.
       - Reacts live to changes of data-force-theme AND (optionally) OS changes when not forced. -->
  <script>
  try {
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    document.documentElement.classList.toggle('dark', prefersDark);
  } catch (e) {}
</script>

  {{- /* Tailwind + Flowbite CSS via Hugo Pipes + minify */ -}}
  {{- $css := resources.Get "css/main.css" | postCSS | minify }}
  <link
    rel="stylesheet"
    href="{{ $css.RelPermalink }}"
    {{ if $css.Data.Integrity }}integrity="{{ $css.Data.Integrity }}"{{ end }}
    crossorigin="anonymous"
  >
</head>

{{- /* Get shared palette once; use for body + navbar */ -}}
{{- $pal := partial "theme/palette.html" . -}}

<body class="flowbite-landing {{ $pal.bodyBg }} {{ $pal.bodyText }} transition-colors duration-200 twinkle-bg">
  {{ partial "navbar.html" . }}

  <main class="min-h-screen">
    <article class="prose prose-zinc max-w-none dark:prose-invert">
      {{ .Content }}
    </article>
  </main>

  <!-- Flowbite JS for interactive components -->
  <script defer src="{{ "js/flowbite.min.js" | relURL }}"></script>

  <!-- Header toggle (optional):
       If you have a button with id="theme-toggle" (and two icons with
       ids theme-toggle-dark-icon / theme-toggle-light-icon), this flips
       the same data-force-theme attribute the color-picker uses. -->
  <script defer>
    document.addEventListener('DOMContentLoaded', () => {
      const html      = document.documentElement;
      const btn       = document.getElementById('theme-toggle');
      const darkIcon  = document.getElementById('theme-toggle-dark-icon');
      const lightIcon = document.getElementById('theme-toggle-light-icon');

      function syncIcons() {
        const isDark = html.classList.contains('dark');
        // Show the icon for the state you can switch TO (common UI pattern)
        if (darkIcon)  darkIcon.classList.toggle('hidden', isDark);     // show moon in light mode
        if (lightIcon) lightIcon.classList.toggle('hidden', !isDark);   // show sun in dark mode
      }

      function flipForcedTheme() {
        const forced = html.getAttribute('data-force-theme'); // "light" | "dark" | null
        if (forced === 'dark')      html.setAttribute('data-force-theme', 'light');
        else if (forced === 'light')html.setAttribute('data-force-theme', 'dark');
        else {
          // No override yet: flip away from current OS/effective state
          const isDark = html.classList.contains('dark');
          html.setAttribute('data-force-theme', isDark ? 'light' : 'dark');
        }
        // Head script will react and toggle html.dark; then update icons
        syncIcons();
      }

      // Initial icon state
      syncIcons();

      // Wire the button if present
      if (btn) btn.addEventListener('click', flipForcedTheme);
    });
  </script>
</body>
</html>
